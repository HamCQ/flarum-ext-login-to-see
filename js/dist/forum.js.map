{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,mBCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,a,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,gC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,+B,aCKxDC,IAAAA,aAAiBC,IAAI,qBAAsB,YAqBzCC,EAAAA,EAAAA,UAASC,IAAAA,UAAuB,YAAa,SAASC,GACpD,IAjB2BC,EAiBrBC,EAAQF,IAGd,GAAIJ,IAAAA,QAAYO,KACd,OAAOD,EAMT,GAFoBA,EAAMf,IAAI,aAEViB,KAAKC,YAAa,CAEpC,IAGMC,GAhCmBL,EA6BJG,KAAKG,MAAMC,KAAKC,eAzBhCR,EAAKS,QACV,uCACA,SAACC,EAAOC,EAAQC,EAAKC,GAEnB,OAAID,EAAIE,WAAW,sBAA8BJ,EAE1C,OAAOC,EAAP,gxBAA4DC,EAAG,mLAAmLC,EAAK,GAChQ,GAVgBb,EAkChBC,EAAMQ,QAAQ,UAAWM,EAAEC,MAAMX,GACnC,CAEA,OAAOJ,CACT,IAGAgB,EAAAA,EAAAA,QAAOnB,IAAAA,UAAuB,WAAY,SAASoB,GACjD,IAAIvB,IAAAA,QAAYO,MACXgB,GAAUA,EAAMC,IAArB,CAEA,IAAMC,EAAWF,EAAMC,IAAIE,cAAc,cACpCD,GAELA,EAASE,iBAAiB,yBAAyBC,QAAQ,SAAAC,GACrDA,EAAIC,QAAQC,gBAChBF,EAAIC,QAAQC,cAAgB,OAE5BF,EAAIG,iBAAiB,QAAS,SAACC,GAC7BA,EAAEC,iBACFlC,IAAAA,MAAUmC,KAAKC,IACjB,GACF,EAbgC,CAclC,EACF,E","sources":["webpack://@hamcq/login-to-see/webpack/bootstrap","webpack://@hamcq/login-to-see/webpack/runtime/compat get default export","webpack://@hamcq/login-to-see/webpack/runtime/define property getters","webpack://@hamcq/login-to-see/webpack/runtime/hasOwnProperty shorthand","webpack://@hamcq/login-to-see/external root \"flarum.core.compat['forum/app']\"","webpack://@hamcq/login-to-see/external root \"flarum.core.compat['common/extend']\"","webpack://@hamcq/login-to-see/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@hamcq/login-to-see/external root \"flarum.core.compat['forum/components/LoginModal']\"","webpack://@hamcq/login-to-see/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/CommentPost'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LoginModal'];","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport CommentPost from 'flarum/forum/components/CommentPost';\nimport LoginModal from 'flarum/forum/components/LoginModal';\n\napp.initializers.add('hamcq/login-to-see', () => {\n  // å ä½å›¾ç‰‡ SVG - ç®€æ´æ¯›ç»ç’ƒæ•ˆæœï¼ˆå¸¦åœ†è§’ï¼Œæ›´å°å°ºå¯¸æç¤ºï¼‰\n  const placeholderSvg = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'%3E%3Cdefs%3E%3CclipPath id='round'%3E%3Crect width='600' height='400' rx='4' ry='4'/%3E%3C/clipPath%3E%3C/defs%3E%3Cg clip-path='url(%23round)'%3E%3Crect width='600' height='400' fill='%23f0f0f0'/%3E%3C/g%3E%3Crect x='175' y='165' width='250' height='70' rx='12' fill='%23ffffff' fill-opacity='0.6' stroke='%23e0e0e0' stroke-width='1'/%3E%3Ctext x='300' y='193' font-family='system-ui,-apple-system,sans-serif' font-size='16' fill='%23666' text-anchor='middle' font-weight='500'%3EğŸ”’ è¯·ç™»å½•åæŸ¥çœ‹å›¾ç‰‡%3C/text%3E%3Ctext x='300' y='215' font-family='system-ui,-apple-system,sans-serif' font-size='12' fill='%23999' text-anchor='middle'%3ELogin to view image%3C/text%3E%3C/svg%3E\";\n  \n  // æ›¿æ¢å›¾ç‰‡çš„å‡½æ•°\n  function replaceImagesInHtml(html) {\n    if (!html) return html;\n    \n    // ä½¿ç”¨æ­£åˆ™æ›¿æ¢æ‰€æœ‰ img æ ‡ç­¾çš„ src\n    return html.replace(\n      /<img([^>]*)\\ssrc=\"([^\"]+)\"([^>]*)>/gi,\n      (match, before, src, after) => {\n        // è·³è¿‡å·²ç»æ˜¯ placeholder çš„å›¾ç‰‡\n        if (src.startsWith('data:image/svg+xml')) return match;\n        \n        return `<img${before} src=\"${placeholderSvg}\" data-original-src=\"${src}\" class=\"login-required-image\" style=\"cursor:pointer;border-radius:4px;max-width:400px;max-height:267px;width:auto;height:auto;display:block;margin:0 auto;\" title=\"ğŸ”’ è¯·ç™»å½•åæŸ¥çœ‹å›¾ç‰‡\"${after}>`;\n      }\n    );\n  }\n  \n  // æ‰©å±• CommentPost çš„ bodyItems æ–¹æ³•\n  override(CommentPost.prototype, 'bodyItems', function(original) {\n    const items = original();\n    \n    // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œä¸åšä»»ä½•ä¿®æ”¹\n    if (app.session.user) {\n      return items;\n    }\n    \n    // è·å– content é¡¹\n    const contentItem = items.get('content');\n    \n    if (contentItem && !this.isEditing()) {\n      // è·å–åŸå§‹ HTML\n      const originalHtml = this.attrs.post.contentHtml();\n      \n      // æ›¿æ¢å›¾ç‰‡\n      const modifiedHtml = replaceImagesInHtml(originalHtml);\n      \n      // æ›¿æ¢ content é¡¹\n      items.replace('content', m.trust(modifiedHtml));\n    }\n    \n    return items;\n  });\n  \n  // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆåœ¨ oncreate ä¸­å¤„ç†ï¼‰\n  extend(CommentPost.prototype, 'oncreate', function(vnode) {\n    if (app.session.user) return;\n    if (!vnode || !vnode.dom) return;\n    \n    const postBody = vnode.dom.querySelector('.Post-body');\n    if (!postBody) return;\n    \n    postBody.querySelectorAll('.login-required-image').forEach(img => {\n      if (img.dataset.listenerAdded) return;\n      img.dataset.listenerAdded = 'true';\n      \n      img.addEventListener('click', (e) => {\n        e.preventDefault();\n        app.modal.show(LoginModal);\n      });\n    });\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","override","CommentPost","original","html","items","user","this","isEditing","modifiedHtml","attrs","post","contentHtml","replace","match","before","src","after","startsWith","m","trust","extend","vnode","dom","postBody","querySelector","querySelectorAll","forEach","img","dataset","listenerAdded","addEventListener","e","preventDefault","show","LoginModal"],"ignoreList":[],"sourceRoot":""}